# 订单池用户手册

## 引言

### 编写目的

本协议适用于订单池服务与第三方接入平台间的行为、数据及事件的交互与传递。 本协议承载于 HTTP 协议，严格遵守 HTTP 协议规范。

### 背景

本协议适用于订单池服务与第三方接入平台间的行为、数据及事件的交互与传递。 本协议承载于 HTTP 协议，严格遵守 HTTP 协议规范。

### 定义

## 概述
订单池服务通过提供http协议接口对外服务，接口文档详见<<订单池服务接口样式>>,接入前请先向中台申请用户网关调用权限

### 产品简介

### 什么是订单服务服务
为公司提供订单管理相关功能

### 产品优势
+ 支持按使用量弹性伸缩扩展
+ 性能优异, 单节点可支持1000qps
+ 按量付费，并提供折扣价套餐

### 产品功能
为各业务团队提供订单管理功能，主要功能点：
+ 通过集成平台同步订单
+ 管理订单与发票关系
+ 自动计算剩余可开金额


## 产品定价

### 计费方式

当前阶段全部免费。


### 赔付方案

如服务可用性低于98%，可按照下表中的标准获得赔偿，且赔偿总额不超过在未达到服务可用性承诺期间内的客户实际支付的服务费。
赔偿的服务费作为一下计费周期的费用抵扣。

|  服务可用性  | 赔偿金额 | 
|  :----  | :----  |
| 低于99%但等于或高于98%  | 10%|
| 低于98%但高于或等于95% | 20% |
| 低于95% | 30% |

## 接口清单
参考[《订单池服务接口样式》](/docs/订单池服务/订单池服务接口样式.md)


## 接入步骤

#### 0.向中台用户中心申请网关调用权限

#### 1.Jar包引入

<!--pom-->
```pom
<dependency>  
  <groupId>xf-bm-xplat-msg</groupId>
  <artifactId>order-client-api</artifactId>
  <version>1.0</version>
</dependency>
```
## 中台订单池服务调用接口示例代码
######以下示例基于unirest客户端发起http调用，示例中url地址基于中台sit环境

#### 新增订单

<!--Java-->
```java
//1.调用网关获取token
String getwayUrl = "http://paas-s.xforceplus.com/api/client/login";//获取网关token url
Map<String, String> param = new HashMap<>();
param.put("clientId", "");//用户中心分配
param.put("secret", "");//用户中心分配
HttpResponse<JsonNode> response =  Unirest.post(getwayUrl)
.body(param).asJson();

String token = response.getBody().getObject().getString("data");

//2.新增订单
String url = "http://paas-s.xforceplus.com/api/{tenantId}/order/v1/orders"; //新增订单url
Order order = new Order();
HttpResponse<BaseResponse<OrderIdsData>> baseResponse = Unirest.post(url)
        .header("x-app-token", token)//网关token
        .routeParam("tenantId", "")//租户id
        .queryString("appId", "")//产线id
        .body(order)
        .asObject(BaseResponse.class);
if (baseResponse.isSuccess()) {
    //业务处理
}
```


#### 修改订单

<!--Java-->
```java
//1.调用网关获取token
String getwayUrl = "http://paas-s.xforceplus.com/api/client/login";//获取网关token url
Map<String, String> param = new HashMap<>();
param.put("clientId", "");
param.put("secret", "");
HttpResponse<JsonNode> response =  Unirest.post(getwayUrl)
.body(param).asJson();

String token = response.getBody().getObject().getString("data");

//2.修改订单信息
String url = "http://paas-s.xforceplus.com/api/{tenantId}/order/v1/orders/{id}"; //修改订单url
UpdateOrder updateOrder = new UpdateOrder();
HttpResponse<BaseResponse<String>> baseResponse = Unirest.patch(url)
        .header("x-app-token", token)//网关token
        .routeParam("tenantId", "")//租户id
        .routeParam("id", "")//订单id
        .queryString("appId", "")//产线id
        .body(updateOrder)
        .asObject(new GenericType<BaseResponse<String>>(){});
if (baseResponse.isSuccess()) {
    //业务处理
}
```

#### 对已存在订单新增订单明细
<!--java-->
```java
//1.调用网关获取token
String getwayUrl = "http://paas-s.xforceplus.com/api/client/login";//获取网关token url
Map<String, String> param = new HashMap<>();
param.put("clientId", "");
param.put("secret", "");
HttpResponse<JsonNode> response =  Unirest.post(getwayUrl)
.body(param).asJson();

String token = response.getBody().getObject().getString("data");

//2.对已存在订单新增订单明细
String url = "http://paas-s.xforceplus.com/api/{tenantId}/order/v1/orders/{id}/items"; //对已存在订单新增订单明细url
AddOrderItem addOrderItem = new AddOrderItem();
HttpResponse<BaseResponse<OrderIdsData>> baseResponse = Unirest.post(url)
        .header("x-app-token", token)//网关token
        .routeParam("tenantId", "")//租户id
        .routeParam("id", "")//订单id
        .queryString("appId", "")//产线id
        .body(addOrderItem)
        .asObject(new GenericType<BaseResponse<OrderIdsData>>(){});
if (baseResponse.isSuccess()) {
    //业务处理
}
```

#### 根据id查询订单
<!--java-->
```java
//1.调用网关获取token
String getwayUrl = "http://paas-s.xforceplus.com/api/client/login";//获取网关token url
Map<String, String> param = new HashMap<>();
param.put("clientId", "");
param.put("secret", "");
HttpResponse<JsonNode> response =  Unirest.post(getwayUrl)
.body(param).asJson();

String token = response.getBody().getObject().getString("data");

//2.根据id查询订单
String url = "http://paas-s.xforceplus.com/api/{tenantId}/order/v1/orders/{id}"; //根据id查询订单url
HttpResponse<BaseResponse<QueryOrderResponse>> baseResponse = Unirest.get(url)
        .header("x-app-token", token)//网关token
        .routeParam("tenantId", "")//租户id
        .routeParam("id", "")//订单id
        .queryString("appId", "")//产线id
        .queryString("relationship", "invoice")//关系信息，可选参数
        .asObject(new GenericType<BaseResponse<QueryOrderResponse>>(){});
if (baseResponse.isSuccess()) {
    //业务处理
}
```
#### 根据订单号查询订单
<!--java-->
```java
//1.调用网关获取token
String getwayUrl = "http://paas-s.xforceplus.com/api/client/login";//获取网关token url
Map<String, String> param = new HashMap<>();
param.put("clientId", "");
param.put("secret", "");
HttpResponse<JsonNode> response =  Unirest.post(getwayUrl)
.body(param).asJson();

String token = response.getBody().getObject().getString("data");

//2.根据业务方订单号查询订单
String url = "http://paas-s.xforceplus.com/api/{tenantId}/order/v1/orders";//根据订单号查询订单url
HttpResponse<BaseResponse<QueryOrderResponse>> baseResponse = Unirest.get(url)
        .header("x-app-token", token)//网关token
        .routeParam("tenantId", "")//租户id
        .queryString("appId", "")//产线id
        .queryString("orderDate", "")//订单生成日期，可选参数
        .queryString("orderNo", "")//订单号
        .queryString("relationship", "invoice")//关系信息，可选参数
        .asObject(new GenericType<BaseResponse<QueryOrderResponse>>(){});
if (baseResponse.isSuccess()) {
    //业务处理
}
```

#### 删除订单信息
<!--java-->
```java
//1.调用网关获取token
String getwayUrl = "http://paas-s.xforceplus.com/api/client/login";//获取网关token url
Map<String, String> param = new HashMap<>();
param.put("clientId", "");
param.put("secret", "");
HttpResponse<JsonNode> response =  Unirest.post(getwayUrl)
.body(param).asJson();

String token = response.getBody().getObject().getString("data");

//2.删除订单
String url = "http://paas-s.xforceplus.com/api/{tenantId}/order/v1/orders/{id}";
HttpResponse<BaseResponse<String>> baseResponse = Unirest.delete(url)
        .header("x-app-token", token)//网关token
        .routeParam("tenantId", "")//租户id
        .queryString("appId", "")//产线id
        .routeParam("id", "")//订单id
        .asObject(new GenericType<BaseResponse<String>>(){});
if (baseResponse.isSuccess()) {
    //业务处理
}
```

#### 删除订单明细信息
<!--java-->
```java
//1.调用网关获取token
String getwayUrl = "http://paas-s.xforceplus.com/api/client/login";//获取网关token url
Map<String, String> param = new HashMap<>();
param.put("clientId", "");
param.put("secret", "");
HttpResponse<JsonNode> response =  Unirest.post(getwayUrl)
.body(param).asJson();

String token = response.getBody().getObject().getString("data");

//2.删除订单明细信息
String url = "http://paas-s.xforceplus.com/api/{tenantId}/order/v1/orders/{id}/items";
DeleteOrderItem deleteOrderItem = new DeleteOrderItem();
HttpResponse<BaseResponse<String>> baseResponse = Unirest.delete(url)
        .header("x-app-token", token)//网关token
        .routeParam("tenantId", "")//租户id
        .queryString("appId", "")//产线id
        .routeParam("id", "")//订单id
        .body(deleteOrderItem)//删除明细信息
        .asObject(new GenericType<BaseResponse<String>>(){});
if (baseResponse.isSuccess()) {
    //业务处理
}
```

#### 对已存在的订单新增发票关系
<!--java-->
```java
//1.调用网关获取token
String getwayUrl = "http://paas-s.xforceplus.com/api/client/login";//获取网关token url
Map<String, String> param = new HashMap<>();
param.put("clientId", "");
param.put("secret", "");
HttpResponse<JsonNode> response =  Unirest.post(getwayUrl)
.body(param).asJson();

String token = response.getBody().getObject().getString("data");

//2.对已存在的订单新增发票关系
String url = "http://paas-s.xforceplus.com/api/{tenantId}/order/v1/orders/{orderId}/invoices";
List<OrderInvoiceRelation> orderInvoiceRelations = new ArrayList<>();
HttpResponse<BaseResponse<String>> baseResponse = Unirest.post(url)
        .header("x-app-token", token)//网关token
        .routeParam("tenantId", "")//租户id
        .queryString("appId", "")//产线id
        .routeParam("orderId", "")//订单id
        .body(orderInvoiceRelations)//发票关系数据
        .asObject(new GenericType<BaseResponse<String>>(){});
if (baseResponse.isSuccess()) {
    //业务处理
}
```

#### 发票作废
<!--java-->
```java
//1.调用网关获取token
String getwayUrl = "http://paas-s.xforceplus.com/api/client/login";//获取网关token url
Map<String, String> param = new HashMap<>();
param.put("clientId", "");
param.put("secret", "");
HttpResponse<JsonNode> response =  Unirest.post(getwayUrl)
.body(param).asJson();

String token = response.getBody().getObject().getString("data");

//2.发票作废
String url = "http://paas-s.xforceplus.com/api/{tenantId}/order/v1/orders/invoices/{invoiceNo}/{invoiceCode}";
HttpResponse<BaseResponse<String>> baseResponse = Unirest.put(url)
        .header("x-app-token", token)//网关token
        .routeParam("tenantId", "")//租户id
        .queryString("appId", "")//产线id
        .routeParam("invoiceNo", "")//发票号码
        .routeParam("invoiceCode", "")//发票代码
        .asObject(new GenericType<BaseResponse<String>>(){});
if (baseResponse.isSuccess()) {
    //业务处理
}
```
## 测试环境

请联系我们获取测试环境信息


## 联系方式
tower@xforceplus.com